import org.ajoberstar.gradle.git.tasks.GitClone

apply plugin: "com.android.application"
apply plugin: "newrelic"
apply plugin: "realm-android"

def argVersionCode	= 25;
def argVersionName	= "1.2.5";
def production		= false;

if(production)
{
	evaluationDependsOn(":android-publisher")
	task getPublisherProject(type: GitClone) {
		def destination = file("../publisher");
		uri = "ssh://git@stash.tween.com.ar:7999/vcg/android-app-publisher.git";
		destinationPath = destination;
		bare = false;
		enabled = !destination.exists(); //to clone only once
	}

	task publishAPKToGooglePlay() << {
		javaexec {
			main = "-jar";
			args = ["../publisher/build/libs/android-app-publisher.jar", "-c", "../publisher/source/main/resources/android-app-publisher.properties " + argVersionName];
		}
	}

	preBuild.doFirst
	{
		if(project.hasProperty("versionCode"))
		{
			argVersionCode = project.versionCode;
		}
		else
		{
			throw new StopExecutionException("You must pass -PversionCode (the APK versionCode) as an argument to the command line") as Throwable;
		}

		if(project.hasProperty("versionName"))
		{
			argVersionName = project.versionName;
		}
		else
		{
			throw new StopExecutionException("You must pass -PversionName (the APK versionName) as an argument to the command line") as Throwable;
		}
	}

	assembleRelease.doLast
	{
		//findProject(":android-publisher").tasks.build.execute();
		//tasks.publishAPKToGooglePlay.execute();
	}
}

android
{
	signingConfigs
	{
		release
		{
			storeFile file("../viacelular.jks")
			storePassword "tween!23"
			keyAlias "viacelular"
			keyPassword "tween!23"
		}
	}
	compileSdkVersion 23
	buildToolsVersion "23.0.3"
	defaultConfig
	{
		applicationId "com.tween.viacelular"
		minSdkVersion 15
		targetSdkVersion 23
		versionCode argVersionCode
		versionName argVersionName
		multiDexEnabled true
		signingConfig signingConfigs.release
	}
	buildTypes
	{
		release
		{
			minifyEnabled false
			proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"
			debuggable false
			jniDebuggable false
			renderscriptDebuggable false
			zipAlignEnabled true
		}
		debug
		{
			debuggable true
			jniDebuggable false
			renderscriptDebuggable false
			minifyEnabled false
			zipAlignEnabled true
		}
	}
	productFlavors
	{
	}
	compileOptions
	{
		sourceCompatibility JavaVersion.VERSION_1_7
		targetCompatibility JavaVersion.VERSION_1_7
	}
	dexOptions
	{
		preDexLibraries true
		javaMaxHeapSize "4g"
		incremental true
		dexInProcess = true
	}
}

repositories
{
	mavenCentral()
	jcenter()
	maven
	{
		url "http://dl.bintray.com/amulyakhare/maven"
	}
	maven
	{
		url "https://jitpack.io"
	}
	flatDir
	{
		dirs "libs"
	}
}

buildscript
{
	repositories
	{
		mavenCentral()
	}

	dependencies
	{
		classpath "org.ajoberstar:gradle-git:0.2.3"
	}
}

dependencies
{
	provided fileTree(dir: "libs", include: ["*.jar"])
	compile fileTree(include: ["*.jar"], dir: "libs")
	testCompile "junit:junit:4.12"
	testCompile "org.mockito:mockito-core:1.10.19"
	compile("com.github.afollestad.material-dialogs:core:0.8.5.8@aar")
	{
		transitive = true
	}
	compile "com.amulyakhare:com.amulyakhare.textdrawable:1.0.1"
	compile "com.android.support:appcompat-v7:23.4.0"
	compile "com.android.support:cardview-v7:23.4.0"
	compile "com.android.support:design:23.4.0"
	compile "com.android.support:multidex:1.0.1"
	compile "com.android.support:recyclerview-v7:23.4.0"
	compile "com.android.support:support-v13:23.4.0"
	compile "com.appboy:android-sdk-ui:1.13.4"
	compile "com.google.android.gms:play-services-ads:9.0.1"
	compile "com.google.android.gms:play-services-analytics:9.0.1"
	compile "com.google.android.gms:play-services-gcm:9.0.1"
	compile "com.google.android.gms:play-services-identity:9.0.1"
	compile "com.google.android.gms:play-services:9.0.1"
	compile "com.newrelic.agent.android:android-agent:5.5.0"
	compile "com.nostra13.universalimageloader:universal-image-loader:1.9.5"
	compile "com.readystatesoftware.systembartint:systembartint:1.0.4"
	compile "de.greenrobot:greendao:2.1.0"
	compile "se.emilsjolander:stickylistheaders:2.7.0"
	compile "de.hdodenhof:circleimageview:2.0.0"
	compile "com.facebook.android:facebook-android-sdk:4.11.0"
	compile "com.squareup.picasso:picasso:2.5.2"
}